<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dragon.Store - Top Up Free Fire</title>
  <style>
    body { font-family: Arial, sans-serif; background: #1b1b1b; color: #fff; margin: 0; padding: 20px; }
    .container { max-width: 500px; margin: auto; background: #2b2b2b; padding: 20px; border-radius: 10px; }
    input, select, button {
      width: 100%; padding: 10px; margin: 10px 0; border: none; border-radius: 5px;
    }
    button { background: #ff5722; color: white; cursor: pointer; }
    button:hover { background: #e64a19; }
    #qris-img { max-width: 100%; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Top Up Free Fire</h2>

    <label>ID Game</label>
    <input type="text" id="user_id" placeholder="Masukkan ID Game FF" />

    <label>Zone ID</label>
    <input type="text" id="zone_id" placeholder="Contoh: 1234" />

    <label>Pilih Nominal</label>
    <select id="product_select">
      <option value="">Loading...</option>
    </select>

    <label>Pilih Pembayaran</label>
    <select id="payment_select">
      <option value="qris">QRIS</option>
      <option value="briva">BRIVA</option>
      <option value="bca">BCA</option>
    </select>

    <button onclick="topUp()">Top Up Sekarang</button>

    <div id="status"></div>
    <img id="qris-img" style="display:none;" />
  </div>

  <script>
    const merchant_id = "M250425XGOP9429XE";
    const secret_key = "fedd3fbd4cdd2c4908c25118d1fb13afe3d0dfb255f27412dbd4139880e1ffde";

    async function fetchProduct() {
      const t = Math.floor(Date.now() / 1000);
      const sign = await generateSignature(merchant_id + "freefire" + t + secret_key);
      
      const res = await fetch("https://api.apigames.id/v2/product/list", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          merchant_id, 
          sign,
          time: t,
          product: "freefire"
        })
      });

      const data = await res.json();
      const select = document.getElementById("product_select");
      select.innerHTML = "";

      data.data.forEach(p => {
        let option = document.createElement("option");
        option.value = p.product_code;
        option.text = `${p.product_name} - Rp${p.price}`;
        select.appendChild(option);
      });
    }

    async function generateSignature(input) {
      const msgUint8 = new TextEncoder().encode(input);
      const hashBuffer = await crypto.subtle.digest("SHA-256", msgUint8);
      return Array.from(new Uint8Array(hashBuffer))
        .map(b => b.toString(16).padStart(2, "0")).join("");
    }

    async function topUp() {
      const user_id = document.getElementById("user_id").value;
      const zone_id = document.getElementById("zone_id").value;
      const product_code = document.getElementById("product_select").value;
      const payment = document.getElementById("payment_select").value;
      const time = Math.floor(Date.now() / 1000);
      const signature = await generateSignature(
        merchant_id + user_id + zone_id + product_code + payment + time + secret_key
      );

      const res = await fetch("https://api.apigames.id/v2/transaksi", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          merchant_id,
          user_id,
          zone_id,
          product_code,
          payment_method: payment,
          sign: signature,
          time
        })
      });

      const json = await res.json();
      const statusDiv = document.getElementById("status");

      if (json.status === 1) {
        statusDiv.innerHTML = `<p><b>Status:</b> ${json.data.status}</p>
          <p><b>Order ID:</b> ${json.data.trx_id}</p>
          <p><b>Total Bayar:</b> Rp${json.data.amount}</p>`;
        if (json.data.qr_url) {
          document.getElementById("qris-img").src = json.data.qr_url;
          document.getElementById("qris-img").style.display = "block";
        }
      } else {
        statusDiv.innerHTML = `<p style="color:red;">Gagal: ${json.message}</p>`;
        document.getElementById("qris-img").style.display = "none";
      }
    }

    fetchProduct();
  </script>
</body>
</html>
