<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Top Up Free Fire</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
    .container { background: white; padding: 20px; border-radius: 10px; max-width: 500px; margin: auto; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .input-group { margin-bottom: 15px; }
    input, select, button { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; }
    .nickname { margin-top: 5px; color: green; font-weight: bold; }
    .error { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Top Up Free Fire</h2>
    <div class="input-group">
      <label for="user_id">Masukkan ID Free Fire:</label>
      <input type="text" id="user_id" placeholder="Contoh: 123456789" oninput="cekNickname()">
      <div id="nickname" class="nickname"></div>
      <div id="error" class="error"></div>
    </div>

    <div class="input-group">
      <label for="product">Pilih Nominal Diamond:</label>
      <select id="product">
        <option value="">-- Pilih --</option>
        <option value="FF10">10 Diamond</option>
        <option value="FF50">50 Diamond</option>
        <option value="FF100">100 Diamond</option>
        <option value="FF200">200 Diamond</option>
      </select>
    </div>

    <div class="input-group">
      <label for="payment">Metode Pembayaran:</label>
      <select id="payment">
        <option value="QRIS">QRIS</option>
        <option value="BRIVA">BRIVA</option>
        <option value="BCA">BCA</option>
      </select>
    </div>

    <button onclick="prosesTopUp()">Top Up Sekarang</button>
  </div>

  <script>
    async function cekNickname() {
      const userId = document.getElementById('user_id').value;
      const nickname = document.getElementById('nickname');
      const error = document.getElementById('error');

      nickname.innerText = '';
      error.innerText = '';

      if (userId.length < 5) return;

      try {
        const merchantId = 'M250425XGOP9429XE';
        const secret = 'fedd3fbd4cdd2c4908c25118d1fb13afe3d0dfb255f27412dbd4139880e1ffde';
        const time = Math.floor(Date.now() / 1000);
        const signature = await generateSignature(merchantId + userId + time + secret);

        const response = await fetch('https://api.duniagames.co.id/api/v1/top-up/merchant/transaction/check-ff', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            merchant_id: merchantId,
            user_id: userId,
            signature: signature,
            timestamp: time
          })
        });

        const data = await response.json();

        if (data?.data?.username) {
          nickname.innerText = 'âœ… ' + data.data.username;
        } else {
          error.innerText = 'ID tidak ditemukan!';
        }
      } catch (err) {
        error.innerText = 'Gagal cek ID!';
      }
    }

    async function generateSignature(text) {
      const encoder = new TextEncoder();
      const data = encoder.encode(text);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    function prosesTopUp() {
      const id = document.getElementById('user_id').value;
      const product = document.getElementById('product').value;
      const payment = document.getElementById('payment').value;

      if (!id || !product || !payment) {
        alert('Isi semua data dulu lah bang!');
        return;
      }

      alert(`Top up ${product} ke ID ${id} pake ${payment} sedang diproses...`);
      // Di sini tinggal lanjutin ke proses order API
    }
  </script>
</body>
</html>
