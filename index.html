<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Top Up Free Fire - Dragon.Store</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #fff;
      padding: 20px;
    }
    .container {
      max-width: 500px;
      margin: auto;
      background-color: #222;
      padding: 20px;
      border-radius: 12px;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      border: none;
    }
    button {
      background-color: #03a9f4;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Top Up Free Fire</h1>

    <label for="user_id">Masukkan ID Akun:</label>
    <input type="text" id="user_id" placeholder="Contoh: 123456789" />

    <button onclick="cekAkun()">Cek Akun</button>
    <div id="hasil_cek"></div>

    <label for="diamond">Pilih Nominal Diamond:</label>
    <select id="diamond">
      <option value="ff5">5 Diamond</option>
      <option value="ff12">12 Diamond</option>
      <option value="ff70">70 Diamond</option>
      <option value="ff140">140 Diamond</option>
      <option value="ff355">355 Diamond</option>
    </select>

    <label for="metode">Pilih Metode Pembayaran:</label>
    <select id="metode">
      <option value="qris">QRIS</option>
      <option value="briva">BRIVA</option>
      <option value="bca">BCA</option>
    </select>

    <button onclick="prosesTopup()">Bayar Sekarang</button>

    <div id="status"></div>
  </div>
<script>
  const merchantId = "M250425XGOP9429XE";
  const secretKey = "fedd3fbd4cdd2c4908c25118d1fb13afe3d0dfb255f27412dbd4139880e1ffde";

  const produkMap = {
    "ff5": "FRE-FIRE5",
    "ff12": "FRE-FIRE12",
    "ff70": "FRE-FIRE70",
    "ff140": "FRE-FIRE140",
    "ff355": "FRE-FIRE355"
  };

  function md5(input) {
    return CryptoJS.MD5(input).toString();
  }

  function cekAkun() {
    const userId = document.getElementById("user_id").value;
    const signature = md5(merchantId + secretKey);
    const url = `https://v1.apigames.id/merchant/${merchantId}/cek-username/freefire?user_id=${userId}&signature=${signature}`;

    fetch(url)
      .then(res => res.json())
      .then(data => {
        if (data?.data?.is_valid) {
          document.getElementById("hasil_cek").innerText = "Username: " + data.data.username;
        } else {
          document.getElementById("hasil_cek").innerText = "Akun tidak ditemukan!";
        }
      })
      .catch(() => alert("Gagal cek akun"));
  }

  function prosesTopup() {
    const userId = document.getElementById("user_id").value;
    const diamond = document.getElementById("diamond").value;
    const metode = document.getElementById("metode").value;
    const refId = "DRAGON" + Date.now();
    const produk = produkMap[diamond];

    const signature = md5(`${merchantId}:${secretKey}:${refId}`);
    const url = `https://v1.apigames.id/v2/transaksi?ref_id=${refId}&merchant_id=${merchantId}&produk=${produk}&tujuan=${userId}&signature=${signature}&server_id=&tipe_pembayaran=${metode}`;

    fetch(url)
      .then(res => res.json())
      .then(data => {
        if (data.status === 1) {
          document.getElementById("status").innerHTML = `
            <p>Transaksi berhasil!</p>
            <a href="${data.data.url_payment}" target="_blank">Klik untuk bayar</a>
          `;
        } else {
          document.getElementById("status").innerText = "Top up gagal: " + data.error_msg;
        }
      })
      .catch(() => alert("Gagal proses top up"));
  }
</script>
